try {
        const response = await fetch(`/api/scripts/${scriptId}`);
        
        if (!response.ok) {
          throw new Error('Script not found');
        }
        
        currentScript = await response.json();
        console.log('Loaded script:', currentScript);
        displayScript(currentScript);
        
      } catch (error) {
        console.error('Failed to load script:', error);
        showError();
      }
    }

    function displayScript(script) {
      document.getElementById('loadingState').style.display = 'none';
      document.getElementById('scriptContent').style.display = 'block';
  
      document.getElementById('pageTitle').textContent = `${script.title} - Vadrifts`;
      document.getElementById('scriptThumbnail').src = script.thumbnail;
      document.getElementById('scriptThumbnail').alt = script.title;
      document.getElementById('scriptGame').textContent = script.game;
      document.getElementById('scriptTitle').textContent = script.title;
      document.getElementById('scriptDescription').textContent = script.description;

      const scriptCodeEl = document.getElementById('scriptCode');
      scriptCodeEl.innerHTML = highlightLua(script.script);
  
      const keyButton = document.getElementById('keyLink');
  
      if (script.key_type === 'no-key') {
        keyButton.style.display = 'none';
      } else if (script.key_type === 'discord') {
        keyButton.style.display = 'flex';
        keyButton.onclick = (e) => {
          e.preventDefault();
          window.open(script.key_link, '_blank');
        };
      } else {
        keyButton.style.display = 'flex';
        keyButton.onclick = (e) => {
          e.preventDefault();
          goToKeySystem();
        };
      }
  
      const featuresList = document.getElementById('featuresList');
      featuresList.innerHTML = script.features.map(feature => `
        <li class="feature-item">
          <i data-lucide="badge-check" class="feature-icon"></i>
          <span>${feature}</span>
        </li>
      `).join('');

      initLucideIcons();
    }

    function goToKeySystem() {
      console.log('goToKeySystem called with scriptId:', currentScriptId);
      console.log('currentScript:', currentScript);
      
      if (!currentScriptId) {
        console.error('No script ID available');
        return;
      }
      
      if (currentScript && currentScript.key_type === 'discord') {
        window.open(currentScript.key_link, '_blank');
      } else {
        const keySystemUrl = `/key-system?script=${currentScriptId}`;
        console.log('Redirecting to:', keySystemUrl);
        window.location.href = keySystemUrl;
      }
    }

    function showError() {
      document.getElementById('loadingState').style.display = 'none';
      document.getElementById('errorState').style.display = 'block';
      initLucideIcons();
    }

    function copyScript() {
      if (!currentScript) return;
      
      navigator.clipboard.writeText(currentScript.script).then(() => {
        showStatus('Script copied to clipboard!', 'success');
      }).catch(err => {
        console.error('Failed to copy script:', err);
        showStatus('Failed to copy script', 'error');
      });
    }

    function copyGameLink() {
      if (!currentScript) return;
      
      const gameLink = currentScript.game_link || 'https://www.roblox.com/games';
      navigator.clipboard.writeText(gameLink).then(() => {
        showStatus('Game link copied to clipboard!', 'success');
      }).catch(err => {
        console.error('Failed to copy game link:', err);
        showStatus('Failed to copy game link', 'error');
      });
    }

    function showStatus(message, type) {
      const statusEl = document.getElementById('statusMessage');
      statusEl.textContent = message;
      statusEl.className = `status-message ${type}`;
      statusEl.classList.add('show');
      
      setTimeout(() => {
        statusEl.classList.remove('show');
      }, 3000);
    }

    let lastScrollTop = 0;
    window.addEventListener('scroll', function() {
      let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
      const navbar = document.querySelector('.navbar');
      
      if (scrollTop > 100) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
      
      lastScrollTop = scrollTop;
    });

    createParticles();
    document.addEventListener('DOMContentLoaded', () => {
      loadScript();
      initLucideIcons();
    });
  
		</script>
	</body>
</html>
